<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Credit Card Expenses</title>

<style>
  @font-face { font-family: 'LovelyCoffee'; src: url('LovelyCoffee.ttf') format('truetype'); }
  @font-face { font-family: 'LouisGeorgeCafe'; src: url('LouisGeorgeCafe.ttf') format('truetype'); }

  body {
    font-family: 'LouisGeorgeCafe', sans-serif;
    background: url('watercolor.png') no-repeat center center fixed;
    background-size: cover;
    margin: 0;
    padding: 0;
    color: #333;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background: rgba(255,255,255,0.88);
    backdrop-filter: blur(20px);
    z-index: -1;
  }

  h1 {
    font-family: 'LovelyCoffee', cursive;
    font-size: 50px;
    text-align: center;
    margin: 18px 0;
  }

  form {
    display: flex;
    flex-direction: column;
    gap: 12px;
    padding: 15px;
    margin: 0 auto;
    max-width: 400px;
  }

  input[type="text"], input[type="number"] {
    padding: 14px;
    font-size: 16px;
    border-radius: 12px;
    border: 1px solid #ccc;
    background: #fff;
  }

  button {
    padding: 6px 8px;
    font-size: 12px;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    background: #cbc4d6;
    color: black;
    font-weight: 600;
    transition: opacity 0.2s;
  }
  button:hover { opacity: 0.85; }

  /* Active Cards - Glassy */
  #itemsTable {
    display: flex;
    flex-direction: column;
    gap: 12px; /* space between cards */
    padding: 8px;
  }

  #itemsTable tr.active-card-row {
    display: flex;
    flex-direction: column;
    gap: 6px;
    padding: 12px;
    background: rgba(255,255,255,0.25);
    backdrop-filter: blur(20px) saturate(180%);
    border-radius: 16px;
    font-size: 16px;
    border: 1px solid rgba(255,255,255,0.3);
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    margin-bottom: 8px;
    cursor: grab;
  }

  #itemsTable tr.active-card-row.transferred {
    background: rgba(208,160,163,0.3);
  }

  .card-header {
    display: flex;
    justify-content: space-between;
    font-weight: bold;
    font-size: 16px;
  }

  /* Bottom row: input left, emoji right */
  .card-bottom {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 6px;
  }

  .card-bottom input[type="number"] {
    width: 100px;
    padding: 6px 8px;
    font-size: 16px;
    border-radius: 8px;
    border: 1px solid rgba(255,255,255,0.5);
    background: rgba(255,255,255,0.3);
    outline: none;
  }

  .card-bottom button {
    font-size: 20px;
    background: none;
    border: none;
    cursor: pointer;
    padding: 2px 4px;
    transition: transform 0.2s;
  }
  .card-bottom button:hover { transform: scale(1.2); }

  .card-container {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    padding: 8px;
    justify-content: center;
  }

  .paid-card {
    flex: 1 1 160px;
    min-width: 150px;
    background: rgba(255,255,255,0.25);
    backdrop-filter: blur(10px);
    border-radius: 14px;
    padding: 12px;
    font-size: 16px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.08);
    position: relative;
  }

  #total {
  font-weight: bold;
  font-size: 16px;
  text-align: center;
  padding: 16px;
  background: rgba(236, 235, 232, 0.9); /* soft glass color with low transparency */
  backdrop-filter: blur(25px) saturate(180%);
  border-radius: 14px;
  border: 1px solid rgba(255, 255, 255, 0.4);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
  position: sticky;
  bottom: 0;
  margin: 8px; /* spacing from edges */
}


</style>
</head>
<body>

<h1>ðŸ’³ Credit Card Expenses</h1>

<form id="itemForm">
  <input type="text" id="itemName" placeholder="Item Name" required>
  <input type="number" id="itemCost" placeholder="Cost" required min="0" step="0.01">
  <button type="submit">Add Item</button>
</form>

<h2>Active Items</h2>
<table id="itemsTable"><tbody></tbody></table>

<h2>Fully Paid Items</h2>
<div id="paidCards" class="card-container"></div>

<div id="total">Total Remaining: $0.00</div>

<div class="bottom-nav">
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAvoNBFAEWNDptC8JIJ2TeuczKuFFmbJVk",
  authDomain: "expenses-a18fa.firebaseapp.com",
  projectId: "expenses-a18fa",
  storageBucket: "expenses-a18fa.appspot.com",
  messagingSenderId: "710897249151",
  appId: "1:710897249151:web:10a31240f099d8e328c84a",
  measurementId: "G-Z0TNKB1L00"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const form = document.getElementById('itemForm');
const itemNameInput = document.getElementById('itemName');
const itemCostInput = document.getElementById('itemCost');
const itemsTableBody = document.querySelector('#itemsTable tbody');
const paidCardsContainer = document.getElementById('paidCards');
const totalDiv = document.getElementById('total');

// Add new item
form.addEventListener('submit', e => {
  e.preventDefault();
  const name = itemNameInput.value.trim();
  const cost = parseFloat(itemCostInput.value);
  if (name && !isNaN(cost) && cost >= 0) {
    db.collection('items').add({
      name, cost, paid: 0, transferred: false,
      archived: false, lastPayments: [],
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    itemNameInput.value = '';
    itemCostInput.value = '';
  }
});

// Swipe-to-delete
function makeSwipeToDelete(element, docId, name) {
  let startX = 0, currentX = 0, dragging = false;
  const threshold = 100;

  element.addEventListener('touchstart', e => { startX = e.touches[0].clientX; dragging = true; });
  element.addEventListener('touchmove', e => { if(!dragging) return; currentX = e.touches[0].clientX - startX; if(currentX<0) element.style.transform=`translateX(${currentX}px)`; });
  element.addEventListener('touchend', handleSwipeEnd);

  element.addEventListener('mousedown', e => { startX = e.clientX; dragging = true; element.style.transition = ''; });
  element.addEventListener('mousemove', e => { if(!dragging) return; currentX = e.clientX - startX; if(currentX<0) element.style.transform=`translateX(${currentX}px)`; });
  element.addEventListener('mouseup', handleSwipeEnd);
  element.addEventListener('mouseleave', handleSwipeEnd);

  function handleSwipeEnd() {
    if(!dragging) return; dragging=false;
    if(currentX<-threshold){
      if(confirm(`Delete "${name}"?`)){ db.collection('items').doc(docId).delete(); } else resetPosition();
    } else resetPosition();
    currentX=0;
  }
  function resetPosition(){ element.style.transition='transform 0.3s'; element.style.transform='translateX(0)'; setTimeout(()=>{element.style.transition='';},300); }
}

// Render Active Items
function renderActiveItems(items){
  itemsTableBody.innerHTML='';
  let totalRemaining=0;
  items.forEach(doc=>{
    const item=doc.data(); const id=doc.id; const paid=parseFloat(item.paid)||0;
    const cost=parseFloat(item.cost)||0; const remaining=Math.max(cost-paid,0);
    const isFullyPaid=cost-paid<=0.001;

    const tr=document.createElement('tr'); tr.classList.add('active-card-row');
    if(item.transferred) tr.classList.add('transferred');

    const headerDiv=document.createElement('div'); headerDiv.classList.add('card-header');
    headerDiv.innerHTML=`<span>${item.name}</span><span>Cost: $${cost.toFixed(2)}</span>`;
    tr.appendChild(headerDiv);

    const bottomDiv=document.createElement('div'); bottomDiv.classList.add('card-bottom');
    const payInput=document.createElement('input'); payInput.type='number'; payInput.min=0; payInput.step='0.01'; payInput.placeholder='0.00'; payInput.disabled=isFullyPaid;
    bottomDiv.appendChild(payInput);

    const transferBtn=document.createElement('button');
    transferBtn.textContent=item.transferred?'ðŸ’°':'ðŸ‘œ';
    transferBtn.title='Mark as transferred';
    transferBtn.addEventListener('click',()=>{ const newTransferred=!item.transferred;
      db.collection('items').doc(id).update({transferred:newTransferred});
      tr.classList.toggle('transferred',newTransferred);
      transferBtn.textContent=newTransferred?'ðŸ’°':'ðŸ‘œ';
    });
    bottomDiv.appendChild(transferBtn);

    tr.appendChild(bottomDiv);
    itemsTableBody.appendChild(tr);

    payInput.addEventListener('change',()=>{
      let payment=parseFloat(payInput.value);
      if(isNaN(payment)||payment<=0){payInput.value='';return;}
      if(payment>remaining+0.001){payInput.value='';return;}
      const newPaid=paid+payment; const isNowFullyPaid=cost-newPaid<=0.001;
      db.collection('items').doc(id).update({
        paid:newPaid, archived:isNowFullyPaid,
        lastPayments:firebase.firestore.FieldValue.arrayUnion({amount:payment,date:new Date().toISOString()})
      }).then(()=>{payInput.value='';});
    });

    makeSwipeToDelete(tr,id,item.name);
    totalRemaining+=remaining;
  });
  totalDiv.textContent=`Total Remaining: $${totalRemaining.toFixed(2)}`;
}

// Render Fully Paid Items
function renderPaidCards(items){
  paidCardsContainer.innerHTML='';
  items.forEach(doc=>{
    const item=doc.data(); if(!item.archived) return;
    const card=document.createElement('div'); card.classList.add('paid-card');
    const nameDiv=document.createElement('div'); nameDiv.textContent=item.name; nameDiv.style.fontWeight='bold'; card.appendChild(nameDiv);
    const paidDiv=document.createElement('div'); paidDiv.textContent=`Paid: $${(item.paid||0).toFixed(2)}`; card.appendChild(paidDiv);
    paidCardsContainer.appendChild(card);
    makeSwipeToDelete(card,doc.id,item.name);
  });
}

// Firestore listener
db.collection('items').orderBy('createdAt').onSnapshot(snapshot=>{
  const activeItems=[]; snapshot.docs.forEach(doc=>{ const data=doc.data(); if(!data.archived) activeItems.push(doc); });
  renderActiveItems(activeItems); renderPaidCards(snapshot.docs);
});
</script>

</body>
</html>
